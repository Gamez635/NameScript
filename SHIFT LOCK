-- SHIFT LOCK EXECUTOR - FULL CUSTOM & DRAGGABLE (PC + MOBILE)
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local plr = Players.LocalPlayer
local character = plr.Character or plr.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local rootPart = character:WaitForChild("HumanoidRootPart")

local shiftLockActive = false

-- === BUAT GUI ===
local sg = Instance.new("ScreenGui")
sg.Name = "ShiftLockGUI"
sg.ResetOnSpawn = false
sg.Parent = plr:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 160, 0, 70)
frame.Position = UDim2.new(0, 15, 0, 15)
frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
frame.BorderColor3 = Color3.fromRGB(255, 255, 255)
frame.BorderSizePixel = 2
frame.Active = true
frame.Draggable = true   -- otomatis support drag PC + HP
frame.Parent = sg

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 14)
corner.Parent = frame

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0.45, 0)
title.BackgroundTransparency = 1
title.Text = "SHIFT LOCK"
title.TextColor3 = Color3.new(1, 1, 1)
title.Font = Enum.Font.GothamBold
title.TextSize = 16
title.Parent = frame

local status = Instance.new("TextLabel")
status.Size = UDim2.new(1, 0, 0.55, 0)
status.Position = UDim2.new(0, 0, 0.45, 0)
status.BackgroundTransparency = 1
status.Text = "OFF"
status.TextColor3 = Color3.fromRGB(255, 70, 70)
status.Font = Enum.Font.GothamBold
status.TextSize = 28
status.Parent = frame

-- === DRAG SUPPORT UNTUK HP (Touch) & PC (Mouse) ===
frame.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		local dragConnection
		local startPos = input.Position
		local startFramePos = frame.Position

		dragConnection = input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragConnection:Disconnect()
			end
		end)

		UserInputService.InputChanged:Connect(function(input2)
			if input2.UserInputType == Enum.UserInputType.MouseMovement or input2.UserInputType == Enum.UserInputType.Touch then
				if input2 == input or input2.UserInputState == Enum.UserInputState.Begin then
					local delta = input2.Position - startPos
					frame.Position = UDim2.new(
						startFramePos.X.Scale,
						startFramePos.X.Offset + delta.X,
						startFramePos.Y.Scale,
						startFramePos.Y.Offset + delta.Y
					)
				end
			end
		end)
	end
end)

-- === FUNGSI SHIFT LOCK ===
local function updateShiftLock()
	if shiftLockActive then
		humanoid.AutoRotate = false
		UserInputService.MouseBehavior = Enum.MouseBehavior.LockCenter
		
		RunService:BindToRenderStep("ShiftLockCustom", Enum.RenderPriority.Character.Value, function()
			local _, y = workspace.CurrentCamera.CFrame:ToEulerAnglesYXZ()
			rootPart.CFrame = CFrame.new(rootPart.Position) * CFrame.Angles(0, y, 0)
		end)
		
		status.Text = "ON"
		status.TextColor3 = Color3.fromRGB(70, 255, 70)
		frame.BorderColor3 = Color3.fromRGB(70, 255, 70)
	else
		humanoid.AutoRotate = true
		UserInputService.MouseBehavior = Enum.MouseBehavior.Default
		RunService:UnbindFromRenderStep("ShiftLockCustom")
		
		status.Text = "OFF"
		status.TextColor3 = Color3.fromRGB(255, 70, 70)
		frame.BorderColor3 = Color3.fromRGB(255, 255, 255)
	end
end

-- === KLIK / SENTUH UNTUK TOGGLE ===
frame.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		shiftLockActive = not shiftLockActive
		updateShiftLock()
	end
end)

-- Karakter respawn tetap jalan
plr.CharacterAdded:Connect(function(newChar)
	character = newChar
	humanoid = newChar:WaitForChild("Humanoid")
	rootPart = newChar:WaitForChild("HumanoidRootPart")
	if shiftLockActive then
		task.wait(0.1)
		updateShiftLock()
	end
end)
